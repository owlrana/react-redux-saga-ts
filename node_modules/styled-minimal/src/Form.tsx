import * as React from 'react';
import styled, { css } from 'styled-components';

import { getTheme, px } from './utils/helpers';
import { baseStyles, mutationStyles, sx, system } from './utils/system';

import MutationWrapper from './MutationWrapper';

import { FormProps } from './types';

export const StyledForm = styled('form')<FormProps>(
  (props) => {
    const { frame } = props;
    const { borderColor, borderRadius, padding } = getTheme(props, 'form');

    return css`
      ${baseStyles};
      background-color: #fff;
      ${frame ? `border: 1px solid ${borderColor};` : ''}
      ${frame ? `border-radius: ${px(borderRadius)};` : ''}
      ${frame ? `padding: ${px(padding)};` : ''}
      ${frame ? mutationStyles({ skipTheme: true }) : ''};
    `;
  },
  sx,
  system,
);

export const Form = React.forwardRef<HTMLFormElement, FormProps>((props, ref) => {
  const { frame } = props;
  const form = <StyledForm ref={ref} {...props} />;

  if (frame) {
    return (
      <MutationWrapper {...props} skipTheme>
        {form}
      </MutationWrapper>
    );
  }

  return form;
});

Form.defaultProps = {
  frame: false,
  method: 'get',
};
